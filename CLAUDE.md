# 漫画本PDFビューワー開発仕様書

## プロジェクト概要
ブラウザで動作する漫画本専用のPDFビューワーを開発する。
漫画の読書体験に最適化されたUI/UXを提供し、日本の漫画と海外の漫画両方に対応する。

## 技術要件
- React 19+ with TypeScript
- Vite（開発環境・ビルドツール）
- pnpm（パッケージ管理）
- PDF.js ライブラリ（npm経由）
- Tailwind CSS v4（スタイリング）
- レスポンシブデザイン（デスクトップ・タブレット・スマートフォン対応）
- ローカルストレージを使用した設定保存
- UIのデザインはシンプルだがモダンな感じで

## 主要機能

### 1. PDFファイル読み込み機能
- ファイル選択ダイアログからの読み込み
- ドラッグ&ドロップによる読み込み
- 対応形式: PDFファイルのみ
- エラーハンドリング: 非対応ファイルや破損ファイルの適切なエラー表示

### 2. 表示機能
- **表示方式**:
  - 単ページ表示（1ページずつ）
  - 見開き表示（2ページ同時）
  - 表示方式の動的切り替え
- **初期設定**: 前回の表示設定を記憶して復元
- **読み方向**:
  - 右から左（日本の漫画形式）- デフォルト
  - 左から右（海外の漫画形式）
  - 設定で切り替え可能

### 3. ページナビゲーション機能
- 前ページ・次ページ移動
- 特定ページへの直接ジャンプ
- ページ情報表示（現在ページ/総ページ数）

### 4. ズーム機能
- マウスホイールによるズーム
- UI ボタン（+/-）によるズーム
- フィット表示オプション（ページ幅・ページ高さ・実寸）

### 5. フルスクリーンモード
- F11キーまたはボタンクリックでフルスクリーン切り替え
- フルスクリーン中も全操作が可能

### 6. 操作方法
- **マウス操作**:
  - 左クリック: 次ページ
  - 右クリック: 前ページ（コンテキストメニュー無効化）
  - ホイール: ズーム
- **キーボード操作**:
  - 左矢印: 前ページ
  - 右矢印: 次ページ
  - +: ズームイン
  - -: ズームアウト
  - F11: フルスクリーン切り替え
  - V: 表示方式切り替え
  - R: 読み方向切り替え
- **タッチ操作**:
  - 左スワイプ: 次ページ
  - 右スワイプ: 前ページ
  - ピンチイン/アウト: ズーム
  - タップ: ページめくり（画面分割対応）

## UI/UX設計

### 1. オーバーレイUI
- 通常時は非表示
- マウス移動やタッチで一定時間表示
- 一定時間操作がないと自動的に非表示

### 2. UIコンポーネント
- **ヘッダーバー**:
  - ファイル選択ボタン
  - 表示方式切り替えボタン
  - 読み方向切り替えボタン
  - フルスクリーンボタン
  - 設定ボタン
- **フッターバー**:
  - ズームボタン（-/+）
  - ページナビゲーション（前/次/ジャンプ）
  - ページ情報表示
- **サイドパネル**（設定画面）:
  - ダークモード切り替え
  - 読み方向設定
  - 初期表示設定
  - キーボードショートカット一覧

### 3. テーマ対応
- ライトモード（デフォルト）
- ダークモード
- Tailwind CSS v4のダークモードクラスを活用
- 設定をローカルストレージに保存

### 4. レスポンシブデザイン
- Tailwind CSS v4のレスポンシブユーティリティを活用
- デスクトップ: 全機能利用可能
- タブレット: タッチ操作最適化
- スマートフォン: 縦持ち・横持ち両対応、UI簡略化

## 開発環境構成

### 1. パッケージ管理・ビルド
- **Node.js**: LTS版（22.x以上）
- **pnpm**: パッケージ管理ツール
- **Vite**: 開発サーバー・ビルドツール
- **TypeScript**: 型安全なJavaScript

### 2. フロントエンド技術
- **React**: UIライブラリ（19.x系最新版）
- **TypeScript**: 型定義・コンパイル
- **Tailwind CSS**: ユーティリティファーストCSS（4.x系）
- **PDF.js**: PDF処理ライブラリ（npm版）

### 3. 必要なnpmパッケージ
```json
{
  "dependencies": {
    "react": "^19.x",
    "react-dom": "^19.x",
    "pdfjs-dist": "^x.x.x"
  },
  "devDependencies": {
    "@types/react": "^19.x",
    "@types/react-dom": "^19.x",
    "@vitejs/plugin-react": "^x.x.x",
    "typescript": "^5.x",
    "vite": "^x.x.x",
    "tailwindcss": "^4.x",
    "autoprefixer": "^10.x",
    "postcss": "^8.x"
  }
}
```

## 技術実装詳細

### 1. PDF処理
- PDF.js（npm: pdfjs-dist）を使用してPDFをCanvasにレンダリング
- React Hooksを使用した状態管理
- ページごとの遅延読み込み（パフォーマンス最適化）
- 高解像度レンダリング対応
- TypeScript型定義によるタイプセーフなPDF操作

### 2. 状態管理
- React Hooks（useState, useEffect, useContext）を活用
- カスタムHooksによる状態管理の抽象化
- 以下の状態をグローバルで管理:
  - 現在ページ
  - ズーム倍率
  - 表示方式
  - 読み方向
  - テーマ設定
- ユーザー設定をlocalStorageで永続化

### 3. コンポーネント設計
- 関数コンポーネント + Hooksパターン
- React 19の新機能（Actions、useOptimistic等）を活用
- TypeScriptインターフェースによる型定義
- 責任分離されたコンポーネント構成
- 再利用可能なUIコンポーネント

### 4. パフォーマンス最適化
- React.memo, useMemo, useCallbackの活用
- 必要なページのみをレンダリング
- 画像キャッシュ機能
- スムーズなページ切り替えアニメーション（Tailwind CSS）

### 5. エラーハンドリング
- TypeScriptの型チェックによるコンパイルエラー防止
- Error Boundaryコンポーネントの実装
- カスタムエラーハンドリングHooks
- ファイル読み込みエラー、PDFパースエラー対応
- ユーザーフレンドリーなエラーメッセージ

### 6. ローディング表示
- Suspenseを活用したローディング状態管理
- ファイル読み込み中のプログレスバー
- ページ切り替え時のローディングスピナー
- 大容量ファイル対応

## プロジェクト構成
```
manga-pdf-viewer/
├── package.json
├── pnpm-lock.yaml
├── tsconfig.json
├── vite.config.ts
├── tailwind.config.js
├── postcss.config.js
├── index.html
├── public/
├── src/
│   ├── main.tsx              # アプリケーションエントリーポイント
│   ├── App.tsx               # メインアプリケーションコンポーネント
│   ├── components/
│   │   ├── ui/               # 再利用可能UIコンポーネント
│   │   │   ├── Button.tsx
│   │   │   ├── Modal.tsx
│   │   │   └── LoadingSpinner.tsx
│   │   ├── PdfViewer.tsx     # PDFビューワーメインコンポーネント
│   │   ├── OverlayUI.tsx     # オーバーレイUI
│   │   ├── HeaderBar.tsx     # ヘッダーバー
│   │   ├── FooterBar.tsx     # フッターバー
│   │   ├── SettingsPanel.tsx # 設定パネル
│   │   └── ErrorBoundary.tsx # エラーバウンダリ
│   ├── hooks/
│   │   ├── usePdfDocument.ts # PDF処理カスタムHook
│   │   ├── useSettings.ts    # 設定管理カスタムHook
│   │   ├── useKeyboard.ts    # キーボード操作カスタムHook
│   │   └── useTouch.ts       # タッチ操作カスタムHook
│   ├── contexts/
│   │   ├── AppContext.tsx    # アプリケーション状態コンテキスト
│   │   └── SettingsContext.tsx # 設定状態コンテキスト
│   ├── types/
│   │   ├── pdf.ts            # PDF関連型定義
│   │   ├── settings.ts       # 設定関連型定義
│   │   └── ui.ts             # UI関連型定義
│   ├── utils/
│   │   ├── pdfWorker.ts      # PDF処理ユーティリティ
│   │   ├── storage.ts        # ローカルストレージユーティリティ
│   │   └── constants.ts      # 定数定義
│   └── styles/
       ├── globals.css        # グローバルスタイル（Tailwind import）
       └── components.css     # コンポーネント固有スタイル
```

## 開発優先度
1. **高**: 基本的なReactコンポーネント構成・TypeScript環境構築
2. **高**: PDF読み込み・表示・ページめくり機能（usePdfDocumentフック）
3. **高**: マウス・キーボード操作（カスタムHooks）
4. **中**: ズーム・フルスクリーン機能
5. **中**: オーバーレイUI・設定画面（React状態管理）
6. **中**: タッチ操作対応（useTouchフック）
7. **低**: Tailwind CSSダークモード・テーマ機能
8. **低**: 高度な最適化・アニメーション

## 成果物
- Viteでビルドされた静的サイト
- npm/pnpmで依存関係管理
- 型安全なTypeScriptコード
- React 19の最新機能を活用した高性能コンポーネント
- 再利用可能なReactコンポーネント
- Tailwind CSS v4による統一されたデザインシステム
- モダンブラウザ対応（Chrome, Firefox, Safari, Edge）

## 開発コマンド
```bash
# 開発環境セットアップ
pnpm install

# 開発サーバー起動
pnpm dev

# 型チェック
pnpm type-check

# ビルド
pnpm build

# プレビュー
pnpm preview
```

## 補足事項
- 漫画の読書体験を最優先に設計
- 直感的な操作感を重視
- 軽量で高速な動作
- オフライン環境での利用可能
