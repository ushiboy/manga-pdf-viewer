# 漫画本PDFビューワー開発仕様書

## プロジェクト概要
ブラウザで動作する漫画本専用のPDFビューワーです。
漫画の読書体験に最適化されたUI/UXを提供し、日本の漫画と海外の漫画両方に対応。
PWA（Progressive Web App）として動作し、オフライン環境でも利用可能です。

## 技術要件
- React 19+ with TypeScript
- Vite（開発環境・ビルドツール）
- pnpm（パッケージ管理）
- PDF.js ライブラリ（npm経由：pdfjs-dist v4.8.69）
- Tailwind CSS v4（スタイリング）
- PWA対応（vite-plugin-pwa v1.0.2）
- Service Worker & Web App Manifest
- レスポンシブデザイン（デスクトップ・タブレット・スマートフォン対応）
- ローカルストレージを使用した設定保存
- UIのデザインはシンプルだがモダンな感じで

## 主要機能

### 1. PDFファイル読み込み機能
- ファイル選択ダイアログからの読み込み
- ドラッグ&ドロップによる読み込み
- 対応形式: PDFファイルのみ
- エラーハンドリング: 非対応ファイルや破損ファイルの適切なエラー表示

### 2. 表示機能
- **表示方式**:
  - 単ページ表示（1ページずつ）
  - 見開き表示（2ページ同時）
  - 表示方式の動的切り替え
- **初期設定**: 前回の表示設定を記憶して復元
- **読み方向**:
  - 右から左（日本の漫画形式）- デフォルト
  - 左から右（海外の漫画形式）
  - 設定で切り替え可能
  - 読み方向に応じたナビゲーション操作の自動調整
- **表紙モード**:
  - 見開き表示時に1ページ目を表紙として単独表示するかの設定
  - ON（デフォルト）：1ページ目単独、2ページ目以降見開き
  - OFF：1ページ目から見開き表示

### 3. ページナビゲーション機能
- 前ページ・次ページ移動
- 特定ページへの直接ジャンプ
- ページ情報表示（現在ページ/総ページ数）

### 4. ズーム機能
- マウスホイールによるズーム
- UI ボタン（+/-）によるズーム
- フィット表示オプション（ページ幅・ページ高さ・実寸）

### 5. フルスクリーンモード
- F11キーまたはボタンクリックでフルスクリーン切り替え
- フルスクリーン中も全操作が可能

### 6. 操作方法
- **マウス操作**:
  - 左クリック: 次ページ（読み方向対応）
  - 右クリック: 前ページ（コンテキストメニュー無効化）
  - ホイール: ズーム
- **キーボード操作**:
  - 左矢印: 前ページ（読み方向対応）
  - 右矢印: 次ページ（読み方向対応）
  - +: ズームイン
  - -: ズームアウト
  - F11: フルスクリーン切り替え
  - V: 表示方式切り替え
  - R: 読み方向切り替え
- **タッチ操作**:
  - スワイプ: ページめくり（読み方向に応じて左右逆転）
  - ピンチイン/アウト: ズーム
  - タップ: ページめくり（画面分割・読み方向対応）
  - ダブルタップ: ズーム切り替え

## UI/UX設計

### 1. オーバーレイUI
- **手動トグル方式**: UI表示/非表示をボタンで切り替え
- **非表示時**: 左上にフローティング表示ボタン（ハンバーガーメニューアイコン）
- **表示時**: ヘッダー左端の非表示ボタンで非表示に切り替え

### 2. UIコンポーネント
- **ヘッダーバー**:
  - ファイル選択ボタン
  - 表示方式切り替えボタン
  - 読み方向切り替えボタン
  - フルスクリーンボタン
  - 設定ボタン
- **フッターバー**:
  - ズームボタン（-/+）
  - ページナビゲーション（前/次/ジャンプ）
  - ページ情報表示
- **設定パネル**（モーダル形式）:
  - 表示方式設定（単ページ・見開き）
  - 読み方向設定（RTL・LTR）
  - 表紙モード設定
  - 設定リセット機能
  - キーボードショートカット一覧

### 3. テーマ対応
- ライトモード（デフォルト）
- ダークモード
- Tailwind CSS v4のダークモードクラスを活用
- 設定をローカルストレージに保存

### 4. レスポンシブデザイン
- Tailwind CSS v4のレスポンシブユーティリティを活用
- デスクトップ: 全機能利用可能
- タブレット: タッチ操作最適化
- スマートフォン: 縦持ち・横持ち両対応、UI簡略化

## 開発環境構成

### 1. パッケージ管理・ビルド
- **Node.js**: LTS版（22.x以上）
- **pnpm**: パッケージ管理ツール
- **Vite**: 開発サーバー・ビルドツール
- **TypeScript**: 型安全なJavaScript

### 2. フロントエンド技術
- **React**: UIライブラリ（19.x系最新版）
- **TypeScript**: 型定義・コンパイル
- **Tailwind CSS**: ユーティリティファーストCSS（4.x系）
- **PDF.js**: PDF処理ライブラリ（npm版）

### 3. 実装済みnpmパッケージ
```json
{
  "dependencies": {
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "pdfjs-dist": "^4.8.69",
    "workbox-window": "^7.3.0"
  },
  "devDependencies": {
    "@types/react": "^19.0.0",
    "@types/react-dom": "^19.0.0",
    "@vitejs/plugin-react": "^4.3.1",
    "typescript": "^5.6.2",
    "vite": "^6.0.1",
    "@tailwindcss/vite": "^4.0.0",
    "tailwindcss": "^4.0.0",
    "vite-plugin-pwa": "^1.0.2"
  }
}
```

## 技術実装詳細

### 1. PDF処理
- PDF.js（npm: pdfjs-dist）を使用してPDFをCanvasにレンダリング
- React Hooksを使用した状態管理
- ページごとの遅延読み込み（パフォーマンス最適化）
- 高解像度レンダリング対応
- TypeScript型定義によるタイプセーフなPDF操作

### 2. 状態管理
- React Hooks（useState, useEffect, useCallback）を活用
- カスタムHooksによる状態管理の抽象化
- 以下の状態をグローバルで管理:
  - 現在ページ
  - ズーム倍率
  - 表示方式（単ページ・見開き）
  - 読み方向（RTL・LTR）
  - 表紙モード設定
  - UIの表示/非表示状態
- ユーザー設定をlocalStorageで永続化
- 設定変更の即座反映

### 3. コンポーネント設計
- 関数コンポーネント + Hooksパターン
- React 19の新機能（Actions、useOptimistic等）を活用
- TypeScriptインターフェースによる型定義
- 責任分離されたコンポーネント構成
- 再利用可能なUIコンポーネント

### 4. パフォーマンス最適化
- React.memo, useMemo, useCallbackの活用
- 必要なページのみをレンダリング
- 画像キャッシュ機能
- スムーズなページ切り替えアニメーション（Tailwind CSS）

### 5. エラーハンドリング
- TypeScriptの型チェックによるコンパイルエラー防止
- Error Boundaryコンポーネントの実装
- カスタムエラーハンドリングHooks
- ファイル読み込みエラー、PDFパースエラー対応
- ユーザーフレンドリーなエラーメッセージ

### 6. ローディング表示
- Suspenseを活用したローディング状態管理
- ファイル読み込み中のプログレスバー
- ページ切り替え時のローディングスピナー
- 大容量ファイル対応

## 実装済みプロジェクト構成
```
comic-viewer/
├── package.json              # 依存関係定義
├── pnpm-lock.yaml           # パッケージロックファイル
├── tsconfig.json            # TypeScript設定（PWA型定義含む）
├── vite.config.ts           # Vite & PWA設定
├── index.html               # エントリーポイント
├── public/
│   ├── favicon-192x192.png  # PWAアイコン（192x192）
│   ├── favicon-512x512.png  # PWAアイコン（512x512）
│   └── icon.svg             # ソースアイコン（SVG）
├── dist/                    # ビルド出力（PWAファイル含む）
│   ├── manifest.webmanifest # PWAマニフェスト
│   ├── sw.js               # Service Worker
│   └── workbox-*.js        # Workboxライブラリ
└── src/
    ├── main.tsx             # アプリケーションエントリーポイント
    ├── App.tsx              # メインアプリケーションコンポーネント
    ├── components/
    │   ├── PdfViewer.tsx    # PDFビューワーメインコンポーネント
    │   ├── OverlayUI.tsx    # オーバーレイUI管理
    │   ├── HeaderBar.tsx    # ヘッダーバー
    │   ├── FooterBar.tsx    # フッターバー（RTL対応）
    │   ├── SettingsPanel.tsx # 設定モーダルパネル
    │   ├── FloatingShowButton.tsx # UI表示ボタン
    │   └── PWAUpdateNotification.tsx # PWA更新通知
    ├── hooks/
    │   ├── usePdfDocument.ts # PDF処理カスタムHook
    │   ├── useSettings.ts   # 設定管理カスタムHook
    │   ├── useKeyboard.ts   # キーボード操作カスタムHook
    │   ├── useTouch.ts      # タッチ操作カスタムHook（RTL対応）
    │   ├── useZoom.ts       # ズーム機能カスタムHook
    │   └── useFullscreen.ts # フルスクリーン機能カスタムHook
    ├── types/
    │   └── settings.ts      # 設定関連型定義
    └── styles/
        └── globals.css      # グローバルスタイル（Tailwind CSS）
```

## 実装完了機能
- ✅ **基本機能**: PDF読み込み・表示・ページめくり・ズーム・フルスクリーン
- ✅ **操作システム**: マウス・キーボード・タッチ操作（RTL/LTR対応）
- ✅ **UI/UX**: 手動トグル式オーバーレイUI・設定パネル・レスポンシブ対応
- ✅ **表示機能**: 単ページ・見開き表示・表紙モード・読み方向対応
- ✅ **設定管理**: localStorage永続化・設定リセット機能
- ✅ **PWA機能**: Service Worker・オフライン対応・インストール可能・自動更新

## 技術的特徴
- **PWA対応**: オフライン利用可能・ホーム画面インストール・自動更新通知
- **RTL/LTR対応**: 日本漫画（右→左）・海外漫画（左→右）の読み方向切り替え
- **レスポンシブ**: デスクトップ・タブレット・スマートフォン完全対応
- **型安全**: TypeScript完全活用・カスタムHooks・コンポーネント設計
- **パフォーマンス**: React 19・Vite・最適化されたキャッシュ戦略

## 成果物
- **PWA対応の漫画専用PDFビューワー**
- Viteでビルドされた高速静的サイト
- Service Worker・Web App Manifest完備
- 型安全なTypeScriptコードベース
- Tailwind CSS v4による統一デザインシステム
- モダンブラウザ対応（Chrome, Firefox, Safari, Edge）

## 開発コマンド
```bash
# 開発環境セットアップ
pnpm install

# 開発サーバー起動
pnpm dev

# 型チェック
pnpm type-check

# ビルド
pnpm build

# プレビュー
pnpm preview
```

## PWA機能詳細

### Service Worker
- アプリケーション本体の完全キャッシュ
- 画像ファイルの効率的キャッシュ（30日間・最大100エントリ）
- PDFファイルは除外（ユーザーストレージ節約）
- 自動更新検知・通知機能

### Web App Manifest
- アプリ名：「漫画本PDFビューワー」（MangaPDF）
- カスタムアイコン：漫画本をイメージしたオリジナルデザイン
- スタンドアロン表示モード
- 画面向き：任意（縦・横両対応）

### インストール & 利用
- ブラウザの「ホーム画面に追加」でPWAインストール
- オフライン環境でアプリ起動・操作可能
- ネイティブアプリ風の体験

## 特徴的な実装

### RTL/LTR対応
- 読み方向に応じたナビゲーション操作の自動調整
- フッターボタンの機能逆転（RTL時）
- スワイプ方向の動的変更
- タップ領域の読み方向対応

### 表紙モード
- 見開き表示での1ページ目の扱いを設定可能
- ON：表紙として単独表示、2ページ目以降見開き
- OFF：1ページ目から見開き表示
- ページナビゲーションロジックの動的調整

### 手動UI制御
- 従来の自動表示/非表示から手動トグルに変更
- フローティング表示ボタンによる直感的操作
- 読書に集中できるUI設計

## 補足事項
- 漫画の読書体験を最優先に設計
- 直感的な操作感を重視
- 軽量で高速な動作
- PWAによるオフライン環境対応
- 日本語・海外漫画両方に最適化
